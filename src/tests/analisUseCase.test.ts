// import { OpenAIAdapter } from "../adapters/openAILangChain.adapter";
// import { PromptTemplateAdapter } from "../adapters/promptTemplate.adapter";
// import { config } from "../config";
// import { AppDataSource, connectDatabase } from "../config/typeOrm";
// import { Prompt } from "../entities";
import { IOpenAILangChain } from "../interfaces/IOpenAILangChain";
import { IPromptTemplate } from "../interfaces/IPromptTemplate";

export class AnalisisUseCase {
    private openAILangChain: IOpenAILangChain;
    private promptTemplate: IPromptTemplate;

    constructor(
        openAILangChain: IOpenAILangChain,
        promptTemplate: IPromptTemplate
    ) {
        this.openAILangChain = openAILangChain;
        this.promptTemplate = promptTemplate;
    }

    public async analizarText(variables: Record<string, any>): Promise<string> {
        const prompt = await this.promptTemplate.format(variables);
        const response = await this.openAILangChain.generate([prompt]);
        return response.generations[0][0].text;
    }
}

// const openAI = new OpenAIAdapter(config.apiKeyOpenAi);

// (async () => {
//     await connectDatabase(); // Inicializa la conexión a la base de datos

//     const template = await AppDataSource.getRepository(Prompt).findOneBy({
//         id: 1,
//     });
//     console.log(template);

//     //Si quieres continuar con el flujo, aquí puedes crear el promptTemplate y el caso de uso:
//     if (template) {
//         const promptTemplate = new PromptTemplateAdapter(template.template, [
//             "contexto",
//             "transcripcion",
//             "parametrosAnalisis",
//             "formatoRespuesta",
//         ]);
//         const analisis = new AnalisisUseCase(openAI, promptTemplate);
//         const variables = {
//             contexto: "cobranza", // consulta para traer el tipo de analisis
//             transcripcion:
//                 "¿Cómo está, señora? Mucho gusto. Le habla Julie Gutiérrez, ejecutiva del Banco Económico. ¿Cómo le va, señora Margot? Mucho gusto, ¿no? Mire, el motivo de mi llamada en esta mañana es para darle a conocer acerca de nuevos beneficios que el banco tiene para usted y la familia. Usted, por ser cliente titular, es la única que podría activar estos beneficios. Y bueno, me gustaría así contar con tres minutos de su tiempo para poder brindarle más información. ¿Podemos contar con ese tiempo? Claro que sí. Perfecto. Muchísimas gracias, señora Margot, por brindarnos su tiempo. Antes que nada, sí es importante que le mencione que esta llamada está siendo grabada para su seguridad y sus resguardos. Es por eso, mire, señora Margot, que le traemos lo que es el Plan Midavec. Dentro de este Plan Midavec encontramos nosotros lo que son, ¿no?, tres grandes beneficios que vienen a ser, ¿no?, dos destinados para lo que es salud. Cuando hablamos de esta, estamos hablando de atenciones para medicina general totalmente gratuitas y de manera ilimitada, a la cual usted va a poder acceder a ellas, incluyendo sus medicamentos, ¿no?, medicamentos siempre y cuando no sean para tratamientos crónicos. Posterior a esto, señora Margot, estaríamos teniendo también lo que son atenciones por el lado de emergencia, ante cualquier accidente cotidiano o tal vez, ¿no?, ante cualquier emergencia, complicación de salud. Usted sabe, estamos cerca a las cenitas de fin de año, ¿no?, y bueno, a veces una comida nos da un poquito mal, ¿no?, porque a veces no estamos en el mismo estado que antes, ¿no? Y bueno, en ese caso, mire, usted va a tener también lo que son sus consultas de emergencia para poder ser atendida, claro que sí, en ese momento, ¿no? Y bueno, usted tendrá 400 bolivianos a su favor para poder ser atendida, ¿no?, estabilizada y retornada a casa, ¿no? Y bueno, señora Margot, ¿cuántas veces usted puede usar sus emergencias? Las veces que sea necesario, ¿no? No habría ningún inconveniente en ello. Y bueno, tendrá clínicas privadas, ¿no?, para poder ser atendida. Por ejemplo, las clínicas ProSalud en todas sus sucursales, también lo que son las clínicas FIES, ¿no?, en todas las sucursales también, y bueno, paralelo a esas cinco clínicas más que nos están acompañando también, ¿no? Y bueno, esta usted va a manejar lo que es su listado de clínicas, ¿no?, para poder saber dónde dirigirse en el caso de necesitar alguna de las clínicas, ¿no? Y bueno, paralelo a eso, señora Margot, hablamos de lo que es un resguardo económico también para los seres queridos. Valoramos, claro que sí, todo el esfuerzo que usted hace por sacar a sus seres queridos adelante, ¿no? Pero sin embargo, en el momento que usted nace, ¿quién tomará, no, esa responsabilidad? Es la pregunta que a veces no nos gusta hacernos porque no nos gusta pensar en ese momento. Sin embargo, usted sabe, ¿no?, que a veces uno no sabe qué le hubiera a pasar, ¿no?, el día de mañana. Y bueno, comentarle que para esos momentos nosotros tenemos, mira, un resguardo de 350.000 bolivianos, ¿no?, los cuales se estarían habilitando si es que usted llegara a faltar a sus seres queridos. Hablamos en el caso de una muerta, por ejemplo, que fuera de manera natural se entregarían 10.000 bolivianos. Y bueno, señora Margot, esos tres grandes beneficios, mire, se terminan de activar con tan solo 90 bolivianos mensuales que vendrían a ser por débito automático. ¿Qué le parece, señora Margot, estos tres grandes beneficios? Me gustaría escucharla. Está buenísimo, pero eso se puede activar en cualquier momento, ¿no?, ¿eh? En este caso, mire, tenemos pocos cupos, solamente se están llamando a algunos clientes. Y bueno, si a usted no le gustaría habilitar, nosotros pasamos a otro cliente, ¿no? Y bueno, no es un seguro que esté, digamos, habilitado todo el tiempo, que usted pueda ir a oficina y habilitarlo, ¿no? Es por eso que solamente se utiliza en la llamada. Somos el calcenter autorizado. No se le pide ningún dato, señora Margot. El único requisito es responder una sola pregunta y ya estaría usted habilitada, ¿no? Usted sabe que posterior a ello, ¿no?, el banco automáticamente se va a ser responsable de lo que son los cobros. No vamos a tener que llamarla, ni siquiera se van a contactar con usted y mucho menos le van a pasar un QR para hacer los pagos, ¿no? Directamente usted lo va a ver en el extracto bajo el concepto de Plan BIDABEC. ¿Qué le parece, señora Margot? Mire, ahorita no es necesario que usted tenga los 90 bolivianos en la cuenta. Dentro de 24, 48 horas recién, el sistema va a estar evitando la cuenta, ¿no? Y con eso ya usted estaría habilitada para poder sacar sus citas médicas, ¿no? Claro que sí, en cualquiera de las clínicas. Tiene habilitada también en la Clínica Prosalud de la Alemana, que es una de nuestras clínicas modelo. También la Clínica CIES, ¿no?, que es una de las clínicas modelo que tenemos. Usted puede usar la de mayor preferencia, ¿no? ¿Qué le parece, señora Margot? Bien, pero en este momento, este... Creo que no lo accedería todavía por este momento. ¿Ya? ¿Cuál sería su inconveniente, señora Margot? Lo que pasa es que pago un pasillo y unas clínicas, así que no podría presentarme. Problemas personales. Ya, personales, pero no económicos. O económicos y personales. También. Bien, bueno, perfecto. A ver, ¿los 90 bolivianos lo ven muy alto, señora Margot? ¿Lo ven muy elevado? ¿Eso es mensual que se paga y lo vas a tener o cómo es la cosa? Exactamente, mensualmente se paga solamente los 90 bolivianos. Ahora, en las clínicas nosotros tenemos la tarifa de una consulta, le sale 150 bolivianos, ¿no? Y una reconsulta le sale como 70 pesos. Entonces, con nosotros, con el seguro, usted no tiene que pagar nada en las consultas, y mucho menos en las reconsultas, ¿no? Esas son totalmente gratuitas. Entonces, eso usted se ahorra, ¿no? Ah, es que sí se pagarían todos los medicamentos y todas esas cosas. No, ni los medicamentos. No. Solamente si en un caso usted, por ejemplo, tiene alguna enfermedad crónica, entonces en ese caso no le cubrimos, ¿no? Pero, por ejemplo, si está ahorita con influenza, con resfrío, sí le vamos a dar sus medicamentos correspondientes, digamos, ¿no? Que es ahorita lo que está de moda, como dicen, ¿no? En cuanto a enfermedades, ¿no? Pero, ir a hacerse atender, está dolorida, le duele algo, puede ir a hacerse atender, ¿no? No habría ningún inconveniente, ¿no? Los medicamentos, así tenga usted 10 consultas en el mes, usted solamente paga 90 bolivianos mensual, ¿me entiende? O puede ir mi familia, o mis hijos. Usted lo es para mí. Perfecto. Muy buena su pregunta, señora Margot. Le comento que usted tiene tres espacios para adicionar a tres familiares más, ¿no? ¿Cuántos hijos tiene? Yo tengo tres. Justo, mire, entrarían los tres ahí, ¿no? En sus espacios, usted. En ese caso, el paquete completo para la familia le sale 120 bolivianos. Pero todos tendrían asistencias médicas, ¿no? Usted sabe que en estas fiestas de fin de año, a veces, por un cohetito, a veces ya nos estamos quemando, ¿no? Y bueno, en ese caso ya usted tendría las atenciones en emergencia, ¿no? Exactamente. ¿Qué le parece? Buenísimo, como le digo. Si usted me dice, mire, la cuenta ahorita no tiene saldo, perfecto. No se preocupe. No es requisito todavía tener los 120 bolivianos. Después de 24, 48 horas, como le digo, usted ya tendría que estar depositando. Si usted me dice, tal vez, bueno, el 20 me depositan, ya, el 20 se estaría haciendo el depósito, ¿no? No habría ningún inconveniente. Pero no se olvide también, mientras que no haya un depósito, usted no va a poder, o sea, si no hubiera los 120, no va a poder habilitar lo que son las consultas, ¿no? Sí, tendría... ¿Y cómo, o sea, en este caso, para ir allá, ¿cómo uno solo presenta los carnets, o cómo se hace para registrar? Para hacerse atender directamente es con, bueno, en emergencia, solamente con su carnet. Ahora, para registrar una cita médica es con agendamiento. Nosotros nos manejamos, una cita médica es aquella que no necesita una emergencia, ¿no? Una fiebre ya es una emergencia, ¿no? Entonces, nosotros nos manejamos a su agenda de usted. Si usted quiere sacar una cita médica para mañana, por ejemplo, tendría que llamar a la línea 810-8820. Entonces, ahí le van a registrar, le van a tomar sus datos, cuál es su número de carnet, su nombre completo, qué es lo que padece, qué síntomas tiene, ¿no? ¿Qué le duele? Entonces, solamente le dicen eso y le van a enviar un mensaje con el código y ese código lo lleva a la clínica para que le habiliten ahí, ¿no?, el pase para entrar a la consulta, nada más. Nosotros sí le enviamos todo el procedimiento, ¿no?, para que usted tome en cuenta. Al comienzo, sí, señora Margot, nosotros le ayudamos con sus agendamientos, ¿no? No hay ningún inconveniente. Ya posterior a esto, ya muchos... Estas son muy independientes, ¿no? Entonces, ya nos olvidan a nosotros y ya no nos toman en cuenta. Solitos manejan sus consultas, ¿no? Entonces, ¿qué le parece? Se habilitamos, entonces. ¿Y para registrarlo, igual ustedes lo registran? Sí, nosotros lo registramos, ¿no? De usted no necesitamos nada. Yo tengo su carnet de identidad, el 7743253 Santa Cruz. Usted está viviendo en el barrio Biscursi, Avenida Final, radial 17 y medio. Y, bueno, el número de teléfono que tenemos registrado es el 7104696. Y, bueno, el número de teléfono que tenemos registrado es el 71046971, al que se le estaría pasando toda la información, ¿no? Sí. Exacto. Ahora, de sus niños solamente necesitaríamos el nombre completo y la fecha de nacimiento, porque si ellos son menores a 14 años, tendrían habilitado lo que son el área de pediatría. Sí. La una tiene seis, el otro nueve y el otro va a cumplir dos estrellas. Miren, los tres entran para pediatría. Usted tiene para elegir los pediatras en las clínicas, ¿no?, que usted manejaría también el listado. Las consultas no son sonificables, señora Margot, ¿no? Si usted está, por ejemplo, en el Fran 3000 visitando a un pariente y necesita, ¿no?, sacar una cita médica por allá, perfecto. Usted la saca y es atendida también, ¿no? No habría ningún inconveniente. Ya. Exacto. Entonces, activamos, señora Margot. En estos momentos no tendría, digamos, los 120, más o menos, hasta los 20, por ahí. Perfecto. Perfecto, no hay problema. El sistema automáticamente lo va a debitar, no se preocupe. En este momento no es necesario. Entonces, señora Margot, déjeme hacerle la pregunta de asegurabilidad, que es la única, ¿no?, es el único requisito. ¿Usted realiza vuelos no comerciales en avionetas aerotaxis o helicópteros? No. Perfecto. Mire, está habilitada con eso. Ahora, señora Margot, bríndeme, por favor, el nombre completo de los niños y la fecha de nacimiento. Ya, este, del mayorcito es Matías, con CH y la I, la I latina nomás. Matías. Ya. Emanuel 2L. Perfecto. Mariscal Vinata. No le escuché el apellido, me lo repite, por favor. Mariscal Vinata. Mariscal Vinata, perfecto. ¿Fecha de nacimiento de Emanuel? El 24 del 12 de 2002. Ya. ¿Quién más? Dylan Josué, con Y. Dylan y... Dylan Josué. ¿Josué, normal? Sí. Sí, normal, Josué nomás, normal. J-O-S-U-E, ¿correcto? Sí. Mariscal Vinata. Sí. Perfecto. ¿Fecha de nacimiento de Dylan? El 5 del 11 del 2005. Ya. ¿Quién más? Emili es la primera fecha latina y la última Y. Ya, Emili. Macbiel con C, D y la Y, Macbiel. Macbiel. Sí, Macbiel. A ver, ese me lo letrea, por favor. M-A. M-A, la C. La G, la D, la Y, la E y la L, Macbiel. Mariscal Vinata. Sí. Perfecto. Ella nació el 22 de junio del 2018. Perfecto, ok, ya están registrados. En el caso de llegar a pasar lo inesperado, señora Margot, ¿a quién colocaríamos como su beneficiario o heredero? ¿Pueden ser los hijos o los niños? Podría ser uno de aquellos, creo. Sí, en general, de preferencia se pone una persona adulta, ¿no? Porque los niños, si son menores de 14 años, tendrían que esperar a sus 14 años para poder cobrar, ¿no? Ah, ya. Sería su papá José Miguel, señora. Ya. ¿Cómo se llama su papá, su esposo? José Miguel. Ya. Mariscal. ¿El otro peligro? Espinosa. Espinosa, concértate. Concértate. Perfecto. Al 100% a él, ¿no? Sí. Perfecto. Perfecto, señora Margot. En breve, hasta las 12 del mediodía, yo le envió lo que es la poliza, ¿no? Para que usted ya la maneje. ¿Qué tal? Yo seré su asesora en línea. Cualquier duda, consulta. Le puedo ayudar con los agendamientos de cita médica. No tenga pena en eso. Vamos a poder ayudarla. Sí, ya. ¿No? Y, bueno, felicitar a la señora Margot por tomar esta decisión responsable. Dígame. Si es de la ramada, se puede ir igual, ¿no? Efectivamente. Tiene el de la ramada y el de la alemana. Porque yo vivo por el kilómetro 6, ¿no? No le di a la guardia. Entonces, ese me tocaría más cerca. Sí, claro que sí. Ese también puede utilizar. No hay ningún inconveniente. Ya usted me pasaría a dónde es lo que, cuáles son las clínicas habilitadas, ¿cierto? Exactamente. Yo le paso el listado porque le comento, señora Margot, algo muy interesante también. La habilitación no solamente es en Santa Cruz. Usted tiene disponible más de 50 clínicas a nivel nacional. Por si tiene que viajar a otro departamento por esta fiesta, puede tener también sus consultas en esas clínicas. Sin hacer ningún trámite. Usted directamente, igual, le sacamos la ficha médica, le pasamos el código y usted será atendido en esas clínicas. Sin ningún inconveniente. ¿No? Ahí también me pasaría qué especialidades o qué, este plan cubre, digamos, ¿no? Exacto. Como me dice usted, son atención médica de, por ejemplo, tos, así, dolor de cabeza, todas estas cositas. Usted me pasaría qué más cubre, ¿no? Sí, sí, efectivamente, yo enseguida le paso todo lo que es la información respecto al seguro, qué le cubre, ¿no? Cuáles son las clínicas habilitadas en medicamentos. Usted también va a poder ver lo que yo le expliqué, que es medicamentos, siempre y cuando no sean para tratamientos crónicos, ¿no? Y bueno, toda la información la va a manejar usted. No se preocupe. Si la pierde, nuevamente, no se preocupe. A veces pasa que cambian de teléfono. Y no quiere decir que por eso usted no sabe ya más de su seguro, no. Le comento, señora Margot, que vamos a estar llamándola durante un periodo, ¿no? Para saber, ¿no? En cuanto a calidad, cómo le está yendo, cómo le fue, ¿no? Hacerle el recuerdo que usted tiene, ¿no? Cuenta con una protección, cuenta con su seguro, con sus atenciones médicas. Entonces, no es que usted se quede solita hoy día y ya nos olvidamos, no. Vamos a estar en constante comunicación con usted, no se preocupe. Bueno, si es por emergencia, puede ser que sí, ¿no? Dependiendo del dolor. No, no es para especialidades, ¿no? Para usted, son medicina general que tiene habilitado. Para los niños, tiene pediatría, ¿no? Para los niños. Ya, pero ahorita lo va a poder ver en el texto que le voy a mandar. Dice, en emergencia, si toca hacer eco, se hace eco, ¿no? Dependiendo de tu perspectiva. ¿Ya? Bueno, señora Margot. Exactamente. Que tengan muy buen día. Hasta luego. Hasta luego.", // consulta para traer la transcirpcion
//             parametrosAnalisis: [
//                 "cliente",
//                 "fechaPedido",
//                 "ciudad",
//                 "direccion",
//                 "telefono",
//                 "preventista",
//                 "horarioPedido",
//                 "numeroTicket",
//             ],

//             formatoRespuesta: "JSON",
//         };

//         const prueba = analisis.analizarText(variables);

//         prueba.then((res) => console.log(res));
//     }
// })();
